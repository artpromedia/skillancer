// =============================================================================
// Copilot Service Prisma Schema
// Sprint: AI Copilot for Freelancers
// =============================================================================

model CopilotInteraction {
  id               String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId           String   @map("user_id") @db.Uuid
  user             User     @relation("UserCopilotInteractions", fields: [userId], references: [id], onDelete: Cascade)

  interactionType  String   @map("interaction_type")
  inputContext      Json     @map("input_context")
  response         String?  @db.Text
  suggestions      String[]
  confidence       Int      @default(0)
  tokensUsed       Int      @default(0) @map("tokens_used")
  processingTimeMs Int      @default(0) @map("processing_time_ms")

  createdAt        DateTime @default(now()) @map("created_at")

  @@index([userId, interactionType])
  @@index([createdAt])
  @@map("copilot_interactions")
}

model ProposalDraft {
  id              String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  user            User     @relation("UserProposalDrafts", fields: [userId], references: [id], onDelete: Cascade)

  jobId           String?  @map("job_id")
  jobTitle        String?  @map("job_title")
  content         String   @db.Text
  suggestedRate   Decimal? @map("suggested_rate") @db.Decimal(10, 2)
  estimatedWinRate Int?    @map("estimated_win_rate")
  keyPoints       String[]
  improvements    Json?
  status          String   @default("DRAFT") // DRAFT, SUBMITTED, ACCEPTED, REJECTED

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@index([userId, status])
  @@index([createdAt])
  @@map("proposal_drafts")
}
